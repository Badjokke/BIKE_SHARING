---
# tasks file for docker_bike_sharing
- name: Clone of a single branch
  ansible.builtin.git:
    repo: https://github.com/Badjokke/BIKE_SHARING.git
    dest: /BIKE_SHARING
    single_branch: yes
    update: yes
    version: docker

- name: Get host info
  community.docker.docker_host_info:
    containers: yes
    images: yes
  register: docker_info

- name: Remove all containers and their volumes
  community.docker.docker_container:
    name: "{{ item }}"
    state: absent
    keep_volumes: no
  loop: "{{ docker_info.containers | map(attribute='Id') }}"

- name: Remove all images
  community.docker.docker_image:
    name: "{{ item }}"
    state: absent
    force_absent: yes
  loop: "{{ docker_info.images | map(attribute='Id') }}"

- name: Docker compose up
  community.docker.docker_compose_v2:
      project_src: /BIKE_SHARING
    